# 3D 布尔运算测试说明

## 已完成的修改

### 重写了 3D 模型生成和布尔运算部分

1. **generate3DModel()** - 主入口函数
   - 检查 CSG 库是否可用
   - 如果可用，调用 `createWallsWithCSG()`
   - 如果不可用，调用 `createSimpleWalls()`

2. **createWallsWithCSG()** - 使用 CSG 创建墙体
   - 为每个墙体创建 Brush
   - 对每个墙体，检查与其他墙体的相交
   - 执行 CSG 减法运算（SUBTRACTION）
   - 将结果 Brush 转换为几何体并添加到场景

3. **createWallBrush(wall)** - 创建单个墙体的 Brush
   - 计算墙体的四个角点
   - 创建 THREE.Shape
   - 使用 ExtrudeGeometry 挤出为 3D
   - 旋转使其垂直
   - 创建并返回 Brush

4. **checkBrushIntersection(brush1, brush2)** - 检查两个 Brush 是否相交
   - 使用包围盒检测

5. **brushToGeometry(brush)** - 将 Brush 转换为几何体
   - 克隆几何体
   - 应用变换矩阵
   - 计算法向量

6. **createSimpleWalls()** - 创建简单墙体（备用方案）
   - 当 CSG 库不可用时使用

7. **createWallGeometry(wall)** - 创建单个墙体的几何体
   - 不使用 CSG，直接创建几何体

## 测试步骤

1. 打开浏览器访问 `http://localhost:5173/`

2. 点击"绘制墙体"按钮

3. 在 2D 视图中绘制两个相交的墙体：
   - 第一个墙体：水平方向
   - 第二个墙体：垂直方向，与第一个墙体相交

4. 查看 3D 视图，应该看到：
   - 两个墙体在相交处被正确裁剪
   - 没有重叠的部分
   - 线框显示清晰的边界

5. 查看浏览器控制台，应该看到：
   ```
   === 开始生成3D模型 ===
   墙体数量: 2
   CSG 库可用: true
   === 使用 CSG 创建墙体 ===
   创建墙体 0 的 Brush 成功
   创建墙体 1 的 Brush 成功
   成功创建 2 个 Brush
   
   处理墙体 0
     墙体 0 与墙体 1 相交，执行减法
     减法成功: XXX -> YYY 顶点
   墙体 0 添加到场景，最终顶点数: YYY
   
   处理墙体 1
     墙体 1 与墙体 0 相交，执行减法
     减法成功: XXX -> YYY 顶点
   墙体 1 添加到场景，最终顶点数: YYY
   
   === CSG 墙体创建完成 ===
   === 3D模型生成完成 ===
   ```

## 预期结果

- ✅ 墙体在相交处被正确裁剪
- ✅ 没有重叠的几何体
- ✅ 顶点数在减法后减少
- ✅ 3D 视图显示清晰的 L 形或 T 形结构

## 如果出现问题

1. **CSG 库未加载**
   - 检查控制台是否显示 "CSG 库可用: false"
   - 检查 `src/main.js` 是否正确导入了 `three-bvh-csg`
   - 检查 `window.Brush`, `window.Evaluator`, `window.SUBTRACTION` 是否存在

2. **布尔运算失败**
   - 检查控制台是否有 "CSG 减法失败" 错误
   - 检查墙体数据是否正确（start, end, thickness, height）
   - 检查几何体是否有效

3. **没有看到效果**
   - 确保两个墙体确实相交（在 2D 视图中可以看到重叠）
   - 检查控制台输出，确认执行了减法运算
   - 检查顶点数是否变化

## 热重载测试

修改 `js/app.js` 中的任何代码，浏览器应该自动刷新并应用更改。
