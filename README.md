Three.js 墙体建模工具
一个基于 Three.js 的交互式墙体建模工具，支持 2D 绘制、3D 模型生成、布尔运算和多视口显示。适用于快速建筑平面布局设计、室内空间原型搭建等场景。
功能特性

2D 绘制：在 2D 视口中通过鼠标点击绘制墙体中心线，支持连续绘制多条墙体
3D 模型生成：根据墙体中心线和厚度参数，自动挤出生成完整 3D 墙体模型
布尔运算：自动处理墙体交叉（T型、L型、十字型等），生成干净的无重叠多边形墙面
多视口显示：四个独立视口同步更新，提供全方位编辑与预览
交互选择：在 3D 视口中点击选择单个墙面，所有视口联动高亮显示
实时预览：绘制过程中实时显示临时线段和完整墙体预览
鼠标焦点自动切换：鼠标位于哪个视口，点击和交互即作用于该视口，无需手动切换

界面布局
四个视口
所有视口背景色统一为深蓝色（#001133），提供舒适的深色主题编辑环境，便于长时间操作。

2D 绘制窗口（左上）：用于绘制墙体中心线，支持实时预览和编辑
3D 模型窗口（右上）：显示挤出生成的完整 3D 墙体模型，支持轨道控制器旋转、缩放、平移
面编辑窗口（左下）：显示当前选中墙面的完整多边形（包含所有顶点）
选中面轮廓线窗口（右下）：仅显示当前选中墙面的干净外轮廓线（布尔运算后结果）

视觉风格

视口背景色：深蓝色 #001133
墙体线框/轮廓线颜色：绿色 #00ff00（明亮纯绿，便于在深色背景上辨识）
选中高亮颜色：黄色 #ffff00（所有视口中选中墙面使用黄色描边或填充高亮）
临时预览线：浅绿色半透明，便于区分正在绘制的线段
3D 墙体材质：浅灰色实体材质，顶部和侧面轻微环境光反射

顶部工具栏

绘制墙体：切换到绘制模式
选择墙面：切换到选择模式
墙体高度：设置挤出高度（默认 3m，可实时调整）
墙体厚度：设置墙体厚度（默认 0.2m，影响所有墙体多边形生成）
清空：清除所有墙体和选中状态

使用方法
绘制墙体（核心交互）

点击“绘制墙体”按钮进入绘制模式
将鼠标移动到 2D 绘制窗口（左上）
左键单击 第一次：确定当前墙体的中心线起点
移动鼠标：实时显示从起点到当前鼠标位置的临时预览线段（绿色）
左键单击 第二次：确定当前墙体的中心线终点，系统自动：
根据设定的墙体厚度生成墙体矩形多边形
将新墙体与其他墙体进行布尔运算合并
更新所有视口显示

继续左键单击可连续绘制下一条墙体（支持链式绘制）
右键单击（任意视口均可）：
取消当前正在绘制的临时线段
结束整条墙体的绘制过程
取消所有选中状态
可随时用于中断操作


选择墙面

点击“选择墙面”按钮进入选择模式
将鼠标移动到 3D 模型窗口（右上）
左键单击目标墙体：该墙面被选中
其他三个视口立即联动，使用黄色高亮显示选中墙面的多边形和轮廓线
右键单击任意视口：取消选中

快速启动
安装依赖
Bashnpm install
启动开发服务器（热重载）
Bashnpm run dev
# 或者
npm start
构建生产版本
Bashnpm run build
预览构建结果
Bashnpm run preview
访问地址：http://localhost:8080（或对应端口）
环境要求

Node.js 16+
npm 7+

技术架构
核心技术栈

Three.js：3D 渲染引擎，负责所有视口的渲染
ClipperLib：高精度 2D 多边形布尔运算（推荐方案，避免浮点误差）
HTML5 Canvas + 原生事件：实现精确鼠标交互与多视口独立响应
原生 JavaScript：全部业务逻辑，无框架依赖，轻量高效

模块结构
textjs/
├── main.js          # 主程序入口、应用管理、事件总线
├── store.js         # 全局状态管理（墙体数据、选中状态、参数等）
├── viewport.js      # 四个视口创建、管理与独立事件绑定
├── drawing.js       # 2D 绘制逻辑（中心线采集、预览、墙体生成）
├── boolean.js       # 布尔运算核心（ClipperLib 封装与回退算法）
├── model3d.js       # 3D 模型生成、挤出、材质管理
├── selection.js     # 选择逻辑、射线检测、视口联动高亮
└── utils.js         # 坐标转换、法向量计算、工具函数
数据流

用户在 2D 视口左键两次点击 → 采集中心线起点与终点
根据墙体厚度计算两侧偏移 → 生成单条墙体矩形多边形
将新多边形加入全局墙体集合 → 执行布尔 Union 运算
得到干净的无重叠墙面多边形集合
挤出为 3D 几何体 → 更新 3D 视口
用户在 3D 视口选择墙面 → 联动更新左下与右下视口，使用黄色高亮显示对应多边形

布尔运算
项目支持两种布尔运算方式：
ClipperLib（推荐）

基于整数坐标运算，完全避免浮点精度问题
支持任意复杂墙体交叉（多墙交汇、自交等）
自动清理碎小多边形、共线点、简化顶点

简化算法（自动回退）

当 ClipperLib 不可用或加载失败时自动启用
基于简单重叠检测与手工合并
适用于墙体数量少、无复杂交叉的场景

浏览器兼容性

Chrome 80+
Firefox 75+
Safari 13+
Edge 80+

要求支持 WebGL 2.0 和 ES6+ 语法。
开发和扩展建议
易扩展方向

门窗开洞：在 boolean.js 中对选中墙面执行 Difference 运算
多层楼板：扩展 store.js 支持多层数据，增加楼层切换控件
材质系统：在 model3d.js 中为不同墙面分配纹理或颜色
导入导出：实现 JSON/SVG/DXF 格式导入导出
撤销重做：引入命令模式（Command Pattern）记录操作历史
曲线/弧形墙：扩展绘制模块支持贝塞尔曲线中心线

调试工具

浏览器控制台可直接访问：
window.app：主应用实例
window.store：全局数据状态
app.getProjectStats()：查看墙体数量、顶点数等统计信息

各模块实例（如 drawing, booleanOps, model3d）均挂载在 window 上便于调试